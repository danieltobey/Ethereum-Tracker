<!DOCTYPE html>
<html>

<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<link rel="stylesheet" href="main.css">
</head>

<script>

function CurrentTime()
{
	// Current time
	var currentDate = new Date();
	// Make it pretty
	var amPm = ' am'
	var hour = currentDate.getHours();
	if (hour > 12)
	{
		hour -= 12;
		amPm = ' pm';
	}
	var min = currentDate.getMinutes();
	if (min < 10)
		min = '0' + min;
	var sec = currentDate.getSeconds();
	if (sec < 10)
		sec = '0' + sec;

	return hour + ':' + min + ':' + sec + amPm;
}

// Display the current price and time it was received
function GetEthPriceReturn(data)
{
	// Show ethereum price
	$('#ethPrice').text('$'+data.USD.toFixed(2));

	$('#lastUpdated').text('Last updated: ' + CurrentTime());
}

// If the market is fluctuating wildly, start getting "numb" to fluctuations.
// Numbing is the multiplier (or divisor) for how big a fluctuation needs to be to warn the user.
var numbing = 1;
// Display the current and last volumes
function GetEthVolumeReturn(data)
{
	var currVol = 0;
	var lastVol = 0;
	for (var i = 0; i < 5; i++)
		currVol += data.Data[i].volumefrom;
	for (var i = 5; i < 10; i++)
		lastVol += data.Data[i].volumefrom;

	currVol = currVol.toFixed(0);
	lastVol = lastVol.toFixed(0);
	$('#currVol').text(currVol);
	$('#lastVol').text(lastVol);

	var percChange = ((currVol - lastVol) / lastVol) * 100;
	$('#percChange').text(percChange.toFixed(0) + '%');

	// If the price changes by more than 50%, alert the room!
	if (Math.abs(percChange) > (100 * numbing))
	{
		$("#volumeMinute").addClass('volumeBigChange');
		numbing++;
	}
	else
	{
		$("#volumeMinute").removeClass('volumeBigChange');
		if (numbing > 1)
			numbing--;
	}
}

// Download the current price
function GetEthPrice()
{
	jQuery.get('https://min-api.cryptocompare.com/data/price?fsym=ETH&tsyms=USD',
		null,
		function(data) { GetEthPriceReturn(data); },
		null);
}

// Download the current volume of trades
function GetEthVolume()
{
	jQuery.get('https://min-api.cryptocompare.com/data/histominute?fsym=ETH&tsym=USD&limit=10&e=CCCAGG',
		null,
		function(data) { GetEthVolumeReturn(data); },
		null);
}

// Call once to initialize data...
GetEthPrice();
GetEthVolume();
// ... then call once every few seconds
setInterval(GetEthPrice, 30000);
setInterval(GetEthVolume, 60000);
</script>

<body>

<!-- Current price -->
<div id='ethPrice'>No data</div>
<!-- Last updated -->
<div id='lastUpdated'>Last updated: never</div>

<div class='volume'>
	<div class='volumeSub' id = "volumeMinute">
		<!-- Current volume -->
		<div class='volLSide'>0-5 minute volume:&nbsp</div><div class='volRSide' id='currVol'>No data</div>
		<!-- Last volume -->
		<br>
		<div class='volLSide'>6-10 minute volume:&nbsp</div><div class='volRSide' id='lastVol'>No data</div>
		<!-- Percent change -->
		<br>
		<div class='volLSide'>Percent change:&nbsp</div><div class='volRSide' id='percChange'>No data</div>
	</div>
</div>

<script>
</script>

</body>

</html>