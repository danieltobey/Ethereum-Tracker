<!DOCTYPE html>
<html lang="en">

<head>
	<!-- JQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<!-- My CSS -->
	<link rel="stylesheet" href="main.css">
	<!-- Bootstrap -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<!-- Roboto font -->
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
</head>

<script>

function CurrentTime()
{
	// Current time
	var currentDate = new Date();
	// Make it pretty
	var amPm = ' am'
	var hour = currentDate.getHours();
	if (hour > 12)
	{
		hour -= 12;
		amPm = ' pm';
	}
	var min = currentDate.getMinutes();
	if (min < 10)
		min = '0' + min;
	var sec = currentDate.getSeconds();
	if (sec < 10)
		sec = '0' + sec;

	return hour + ':' + min + ':' + sec + amPm;
}

// Display the current price and time it was received
function GetEthPriceReturn(data)
{
	// Show ethereum price
	$('#ethPrice').text('$'+data.USD.toFixed(2));

	$('#lastUpdated').text('Last updated: ' + CurrentTime());
}

// If the market is fluctuating wildly, start getting "numb" to fluctuations.
// Numbing is the multiplier (or divisor) for how big a fluctuation needs to be to warn the user.
var numbing = 1;
// Display the current and last volumes
function GetEthVolumeReturn(data)
{
	var currVol = 0;
	var lastVol = 0;
	for (var i = 0; i < 5; i++)
		currVol += data.Data[i].volumefrom;
	for (var i = 5; i < 10; i++)
		lastVol += data.Data[i].volumefrom;

	$('#currVol').text(currVol.toFixed(0));
	$('#lastVol').text(lastVol.toFixed(0));

	var percChange = ((currVol - lastVol) / lastVol) * 100;
	$('#percChange').text(percChange.toFixed(0) + '%');

	// If the price changes by more than 50%, alert the room!
	if (Math.abs(percChange) > (100 * numbing))
	{
		$("#volumeMinute").addClass('volumeBigChange');
		numbing++;
		//var snd = new Audio("horn.wav");
		//snd.play();
	}
	else
	{
		$("#volumeMinute").removeClass('volumeBigChange');
		if (numbing > 1)
			numbing--;
	}
}

// Display the current price and time it was received
function GetEthAvgReturn(data)
{
	$("#24hrHigh").text('$' + data.RAW.HIGH24HOUR.toFixed(0));
	$("#24hrLow").text('$' + data.RAW.LOW24HOUR.toFixed(0));
}


// Download the current price
function GetEthPrice()
{
	jQuery.get('https://min-api.cryptocompare.com/data/price?fsym=ETH&tsyms=USD',
		null,
		function(data) { GetEthPriceReturn(data); },
		null);
}

// Download the current volume of trades
function GetEthVolume()
{
	jQuery.get('https://min-api.cryptocompare.com/data/histominute?fsym=ETH&tsym=USD&limit=10&e=CCCAGG',
		null,
		function(data) { GetEthVolumeReturn(data); },
		null);
}

// Gets average data
function GetEthAvg()
{
	jQuery.get('https://min-api.cryptocompare.com/data/generateAvg?fsym=ETH&tsym=USD&markets=Poloniex,Kraken,Coinbase',
		null,
		function(data) { GetEthAvgReturn(data); },
		null);
}

// Call once to initialize data...
GetEthPrice();
//GetEthVolume();
GetEthAvg();
// ... then call once every few seconds
setInterval(GetEthPrice, 60000);
//setInterval(GetEthVolume, 60000);
</script>

<body>
<div class='container'>
	<div class='row'>
		<!-- Current price -->
		<div id='ethPrice' class='col-md-12'>No data</div>
	</div>
	<div class='row'>
		<!-- Last updated -->
		<div id='lastUpdated' class='col-md-12'>Last updated: never</div>
	</div>

	<!--<div class='volume'>
		<div class='volumeSub' id = "volumeMinute">-->

<!--
	<div class='row'>
		<!-- Current volume --
		<div class='col-xs-6 left'>0-5 minute volume:</div>
		<div class='col-xs-6 right' id='currVol'>No data</div>
	</div>
	<div class='row'>
		<!-- Last volume --
		<div class='col-xs-6 left'>6-10 minute volume:</div>
		<div class='col-xs-6 right' id='lastVol'>No data</div>
	</div>
	<div class='row'>
		<!-- Percent change --
		<div class='col-xs-6 left'>Volume change:</div>
		<div class='col-xs-6 right' id='percChange'>No data</div>
	</div>
-->
		<!--</div>
	</div>-->

	<div class='row'>
		<div class='col-xs-6 left'></div>
		<div class='col-xs-6 right'></div>
	</div>
	<div class='row'>
		<div class='col-xs-6 left'>24-hr high:</div>
		<div class='col-xs-6 right' id='24hrHigh'>No data</div>
	</div>	
	<div class='row'>
		<div class='col-xs-6 left'>24-hr low:</div>
		<div class='col-xs-6 right' id='24hrLow'>No data</div>
	</div>
</div>
</body>

</html>