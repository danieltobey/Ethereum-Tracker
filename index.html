<!DOCTYPE html>
<html>

<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<link rel="stylesheet" href="main.css">
</head>

<script>

function CurrentTime()
{
	// Current time
	var currentDate = new Date();
	// Make it pretty
	var amPm = ' am'
	var hour = currentDate.getHours();
	if (hour > 12)
	{
		hour -= 12;
		amPm = ' pm';
	}
	var min = currentDate.getMinutes();
	if (min < 10)
		min = '0' + min;
	var sec = currentDate.getSeconds();
	if (sec < 10)
		sec = '0' + sec;

	return hour + ':' + min + ':' + sec + amPm;
}

// Display the current price and time it was received
function GetEthPriceReturn(data)
{
	// Show ethereum price
	$('#ethPrice').text('$'+data.USD.toFixed(2));

	$('#lastUpdated').text('Last updated: ' + CurrentTime());
}

// Display the current and last volumes
var lastVol = -1;
var lastTime = CurrentTime();
function GetEthVolumeReturn(data)
{
	var currVol = data.Data[0].volumefrom;

	$('#currVol').text(currVol + ' (' + CurrentTime() + ')');

	if (lastVol === -1)
	{
		lastVol = currVol;
		lastTime = CurrentTime();
		$('#lastVol').text(lastVol + ' (' + lastTime + ')');
	}
	else if (lastVol != currVol)
	{
		$('#lastVol').text(lastVol + ' (' + lastTime + ')');

		// If the price changes by more than 50%, alert the room!
		if (Math.abs(lastVol - currVol) > Math.abs(0.5 * lastVol))
			$("#volumeMinute").addClass('volumeBigChange');
		else
			$("#volumeMinute").removeClass('volumeBigChange');

		lastVol = currVol;
		lastTime = CurrentTime();
	}
}

// Download the current price
function GetEthPrice()
{
	jQuery.get('https://min-api.cryptocompare.com/data/price?fsym=ETH&tsyms=USD',
		null,
		function(data) { GetEthPriceReturn(data); },
		null);
}

// Download the current volume of trades
function GetEthVolume()
{
	jQuery.get('https://min-api.cryptocompare.com/data/histominute?fsym=ETH&tsym=USD&limit=1&e=CCCAGG',
		null,
		function(data) { GetEthVolumeReturn(data); },
		null);
}

// Call once to initialize data...
GetEthPrice();
GetEthVolume();
// ... then call once every 30 seconds
var interval = 2000;
setInterval(GetEthPrice, interval);
setInterval(GetEthVolume, interval);
</script>

<body>

<!-- Last updated -->
<div id='lastUpdated'>Last updated: never</div>
<!-- Current price -->
<div id='ethPrice'>No data</div>

<div class='volume'>
	<h2>Volumes</h2>
	<div class='volumeSub' id = "volumeMinute">
		<h3>Minute</h3>
		<!-- Current volume -->
		<div class='volLSide'>Current volume:&nbsp</div><div class='volRSide' id='currVol'>No data</div>
		<!-- Last volume -->
		<br>
		<div class='volLSide'>Last volume:&nbsp</div><div class='volRSide' id='lastVol'>No data</div>
	</div>
</div>

<script>
</script>

</body>

</html>